"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.object = void 0;
const utils_1 = require("@dedot/utils");
const deshape_js_1 = require("../deshape.js");
function shouldDecodeObject(input) {
    if ((0, utils_1.isHex)(input) || (0, utils_1.isU8a)(input) || (0, utils_1.isString)(input) || !(0, utils_1.isObject)(input)) {
        return false;
    }
    return true;
}
function decodeObject($shape, input) {
    const { args } = $shape.metadata[0];
    return args
        .map((one) => one.metadata[0])
        .reduce((o, { factory, args: [name, field] }) => {
        const fieldInput = input[name];
        const isOptional = factory === deshape_js_1.optionalField;
        if (isOptional && (fieldInput === null || fieldInput === undefined)) {
            o[name] = undefined;
        }
        else {
            o[name] = field.tryDecode(fieldInput);
        }
        return o;
    }, {});
}
function object(...members) {
    const shaped = (0, deshape_js_1.object)(...members);
    shaped.registerDecoder(shouldDecodeObject, decodeObject);
    return shaped;
}
exports.object = object;
